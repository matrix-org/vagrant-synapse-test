"""create_room_distribution

Usage:
    create_room_distribution --num-rooms=<n> --num-users=<n> --room-dist=<distribution> --user-dist=<distribution>
"""

from docopt import docopt
import random
import yaml


if __name__ == '__main__':
    arguments = docopt(__doc__)

    room_dist_split = arguments["--room-dist"].split(",")
    room_dist_args = [float(a) for a in room_dist_split[1:]]
    room_dist = getattr(random, room_dist_split[0])

    user_dist_split = arguments["--user-dist"].split(",")
    user_dist_args = [float(a) for a in user_dist_split[1:]]
    user_dist = getattr(random, user_dist_split[0])

    users = int(arguments["--num-users"])
    num_rooms = int(arguments["--num-rooms"])

    result = [{"users": set()} for _ in range(num_rooms)]

    def get_num_rooms_for_user():
        r = 0
        while not 1 < r < num_rooms:
            r = int(round(user_dist(*user_dist_args)))
        return r

    def get_room():
        r = -1
        while not 0 <= r < num_rooms:
            r = int(round(room_dist(*room_dist_args)))
        return r


    size = 0
    while size < num_rooms:
        for i in range(0, users):
            result[r]["users"].add(get_room())
        size = len([r for r in result if len(r["users"]) > 1])
        print size

    print yaml.dump([
        {"users": list(r["users"])}
        for r in result
        if len(r["users"]) > 1
    ])
